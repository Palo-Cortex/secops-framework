fromversion: 5.0.0
adopted: true
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 5.0.0
    isoverridable: false
    itemVersion: 3.0.29
    packID: ""
    packName: SOC Framework Unified
    prevname: ""
    supportedModules: []
    toServerVersion: ""
description: |-
  Primary owners: Alert responders, automation, endpoint/network teams.

  Analyst role: May initiate or recommend containment actions (isolate host, disable account, block IP), often via playbook automation or escalation.
dirtyInputs: true
id: 'SOC Endpoint Containment_V3'
inputSections:
- description: Generic group for inputs
  inputs:
  - AutoContainment
  - HostContainment
  - FileContainment
  - EndpointID
  - FileHash
  - FilePath
  - FileRemediation
  - ShadowMode
  - Hostname
  - FeaturedHost
  - FileVerdict
  - SourceBrand
  name: General (Inputs group)
inputs:
- description: |-
    Whether to execute containment plan (except isolation) automatically.
    The specific containment playbook inputs should also be set to 'True'.
  key: AutoContainment
  playbookInputQuery: null
  required: false
  value:
    simple: "False"
- description: Whether to execute endpoint isolation.
  key: HostContainment
  playbookInputQuery: null
  required: false
  value:
    simple: "True"
- description: Set to 'True' to quarantine the identified file.
  key: FileContainment
  playbookInputQuery: null
  required: false
  value:
    simple: "True"
- description: The endpoint ID to run commands over.
  key: EndpointID
  playbookInputQuery: null
  required: false
  value:
    simple: ${Analysis.primary_entity_id}
- description: The file hash to block.
  key: FileHash
  playbookInputQuery: null
  required: false
  value:
    simple: ${SOCFramework.Artifacts.File}
- description: The path of the file to block.
  key: FilePath
  playbookInputQuery: null
  required: false
  value:
    simple: ${SOCFramework.Artifacts.FilePath}
- description: "Choose 'Quarantine' or 'Delete'  to avoid file remediation conflicts.
    \nFor example, choosing 'Quarantine' ignores the 'Delete file' task under the
    eradication playbook and will execute only file quarantine."
  key: FileRemediation
  playbookInputQuery: null
  required: false
  value:
    simple: Quarantine
- description: ""
  key: ShadowMode
  playbookInputQuery: null
  required: false
  value:
    simple: ${SOCFramework.shadow_mode}
- description: ""
  key: Hostname
  playbookInputQuery: null
  required: false
  value:
    simple: ${SOCFramework.Artifacts.HostName}
- description: Is this a Featured Host?
  key: FeaturedHost
  playbookInputQuery: null
  required: false
  value:
    simple: "False"
- description: File Verdict from Enrichment
  key: FileVerdict
  playbookInputQuery: null
  required: false
  value:
    simple: ${Analysis.verdict}
- description: This is the Source Brand for the Integration.  Set in the SOCProductCategoryMap_V3
    List.
  key: SourceBrand
  playbookInputQuery: null
  required: false
  value:
    simple: ${SOCFramework.Product.response}
name: SOC Endpoint Containment_V3
outputSections:
- description: Generic group for outputs
  name: General (Outputs group)
  outputs:
  - Blocklist.Final
  - QuarantinedFilesFromEndpoints
  - Core.blocklist.added_hashes
  - Core.Isolation.endpoint_id
outputs:
- contextPath: Blocklist.Final
  description: The blocked accounts.
  type: unknown
- contextPath: QuarantinedFilesFromEndpoints
  description: The quarantined files from endpoint.
  type: unknown
- contextPath: Core.blocklist.added_hashes
  description: The file Hash that was added to the blocklist.
- contextPath: Core.Isolation.endpoint_id
  description: The isolated endpoint ID.
sourceplaybookid: Containment Plan
starttaskid: "0"
tags:
- SOC
- SOC_Framework_Unified
- Containment
- NIST 800-61
- EndPoint
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "150"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 8b859cdc-d653-40d8-88b5-856b497221a5
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: ""
      playbooktaskmissingcomponent: null
      version: -1
    taskid: 8b859cdc-d653-40d8-88b5-856b497221a5
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 295,
          "y": 50
        }
      }
  "48":
    continueonerrortype: ""
    id: "48"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "165"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 5683bb61-e50c-4fee-8006-76a9d2cd15e6
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: Isolate Device
      playbooktaskmissingcomponent: null
      type: title
      version: -1
    taskid: 5683bb61-e50c-4fee-8006-76a9d2cd15e6
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 622.5,
          "y": 1130
        }
      }
  "50":
    continueonerrortype: ""
    id: "50"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "168"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 1cc8a082-9506-43d3-86ed-50836d2be721
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: Quarantine File
      playbooktaskmissingcomponent: null
      type: title
      version: -1
    taskid: 1cc8a082-9506-43d3-86ed-50836d2be721
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1130
        }
      }
  "138":
    conditions:
    - condition:
      - - ignorecase: true
          left:
            iscontext: true
            value:
              complex:
                root: inputs.AutoContainment
          operator: isEqualString
          right:
            value:
              simple: "True"
      label: "yes"
    continueonerrortype: ""
    id: "138"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "139"
      "yes":
      - "147"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |+
        Whether to perform containment actions automatically or manually.

      id: ba28dbc8-bdbf-43ef-8124-2878feeb213e
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: Should containment automatically?
      playbooktaskmissingcomponent: null
      type: condition
      version: -1
    taskid: ba28dbc8-bdbf-43ef-8124-2878feeb213e
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 285,
          "y": 590
        }
      }
  "139":
    continueonerrortype: ""
    form:
      description: Select which containment actions to perform
      expired: false
      questions:
      - defaultrows: []
        fieldassociated: ""
        gridcolumns: []
        id: "0"
        label: ""
        labelarg:
          simple: Select the Endpoint to isolate by Endpoint name
        options: []
        optionsarg:
        - complex:
            accessor: endpoint_name
            root: Core.Endpoint
            transformers:
            - operator: uniq
        placeholder: ""
        readonly: false
        required: false
        tooltip: ""
        type: multiSelect
      - defaultrows: []
        fieldassociated: ""
        gridcolumns: []
        id: "1"
        label: ""
        labelarg:
          simple: Select Endpoint to isolate by Endpoint ID
        options: []
        optionsarg:
        - complex:
            root: inputs.EndpointID
            transformers:
            - operator: uniq
        placeholder: ""
        readonly: false
        required: false
        tooltip: ""
        type: multiSelect
      - defaultrows: []
        fieldassociated: ""
        gridcolumns: []
        id: "2"
        label: ""
        labelarg:
          simple: Select Files to quarantine
        options: []
        optionsarg:
        - complex:
            root: FilesList
            transformers:
            - operator: uniq
            - args:
                applyIfEmpty: {}
                defaultValue:
                  iscontext: true
                  value:
                    simple: inputs.FilePath
              operator: SetIfEmpty
        placeholder: ""
        readonly: false
        required: false
        tooltip: ""
        type: multiSelect
      - defaultrows: []
        fieldassociated: ""
        gridcolumns: []
        id: "3"
        label: ""
        labelarg:
          simple: 'Select Files Hash to block '
        options: []
        optionsarg:
        - complex:
            root: inputs.FileHash
            transformers:
            - operator: uniq
        - {}
        placeholder: ""
        readonly: false
        required: false
        tooltip: ""
        type: multiSelect
      sender: ""
      title: Which containment actions would you like to perform?
      totalanswers: 0
    id: "139"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc: null
      body: null
      cc: null
      format: ""
      methods: []
      subject: null
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: true
        retriescount: 2
        retriesinterval: 360
      to: null
    nexttasks:
      '#none#':
      - "147"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Select which indicators to block.
      id: eeedc27d-be4e-4065-adb7-cf22d2f6a75d
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: Which containment actions would you like to perform?
      playbooktaskmissingcomponent: null
      type: collection
      version: -1
    taskid: eeedc27d-be4e-4065-adb7-cf22d2f6a75d
    timertriggers: []
    type: collection
    view: |-
      {
        "position": {
          "x": 172.5,
          "y": 775
        }
      }
  "147":
    continueonerrortype: ""
    id: "147"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "50"
      - "48"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: f486236e-11d4-4d91-8f9d-252577239705
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: Containment
      playbooktaskmissingcomponent: null
      type: title
      version: -1
    taskid: f486236e-11d4-4d91-8f9d-252577239705
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 285,
          "y": 960
        }
      }
  "148":
    continueonerrortype: ""
    id: "148"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 48ad472b-5301-4524-899a-41e29d38151d
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: Done
      playbooktaskmissingcomponent: null
      type: title
      version: -1
    taskid: 48ad472b-5301-4524-899a-41e29d38151d
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 387.5,
          "y": 1855
        }
      }
  "149":
    continueonerror: true
    continueonerrortype: errorPath
    id: "149"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#error#':
      - "151"
      '#none#':
      - "138"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: FilesList
      stringify:
        simple: "false"
      value:
        complex:
          root: inputs.FilePath
          transformers:
          - args:
              array1_key:
                iscontext: true
              array2:
                iscontext: true
                value:
                  simple: inputs.FileHash
              array2_key: {}
              determine_output_length_by: {}
              merge_dict: {}
              output_name1:
                value:
                  simple: Path
              output_name2:
                value:
                  simple: Hash
            operator: MakePair
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: f93cc26a-6b45-420b-8ec8-c33e920be3a7
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: Set Process list
      playbooktaskmissingcomponent: null
      script: Set
      type: regular
      version: -1
    taskid: f93cc26a-6b45-420b-8ec8-c33e920be3a7
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 510,
          "y": 405
        }
      }
  "150":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.FilePath
          operator: isNotEmpty
          right:
            value: {}
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.FileHash
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "150"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "138"
      "yes":
      - "149"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if the file path and file hash are defined.
      id: d3750674-0c66-4ecc-8c51-8d01487249d7
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: The file path and file hash defined?
      playbooktaskmissingcomponent: null
      type: condition
      version: -1
    taskid: d3750674-0c66-4ecc-8c51-8d01487249d7
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 295,
          "y": 220
        }
      }
  "151":
    continueonerrortype: ""
    id: "151"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      id: 2bd9441a-09d2-4286-8c0f-b3bfec13291e
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: Foundation - Foundation - Error Handling_V3
      playbookId: Foundation - Foundation - Error Handling_V3
      playbooktaskmissingcomponent: null
      type: playbook
      version: -1
    taskid: 2bd9441a-09d2-4286-8c0f-b3bfec13291e
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 715,
          "y": 590
        }
      }
  "158":
    continueonerrortype: ""
    id: "158"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc: null
      body:
        simple: Would you like to Isolate the device ${inputs.Hostname}
      cc: null
      format: ""
      methods: []
      replyOptions:
      - "Yes"
      - "No"
      subject: null
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: true
        retriescount: 2
        retriesinterval: 360
      to: null
    nexttasks:
      "No":
      - "148"
      "Yes":
      - "169"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 6276c905-eedb-4266-8544-042d9051abb3
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: Isolate Device?
      playbooktaskmissingcomponent: null
      type: condition
      version: -1
    taskid: 6276c905-eedb-4266-8544-042d9051abb3
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 745,
          "y": 1485
        }
      }
  "161":
    continueonerrortype: ""
    id: "161"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    message:
      bcc: null
      body:
        simple: Should we quarantine the file ${issue.filename}
      cc: null
      format: ""
      methods: []
      replyOptions:
      - "Yes"
      - "No"
      subject: null
      timings:
        completeafterreplies: 1
        completeaftersla: false
        completeafterv2: true
        retriescount: 2
        retriesinterval: 360
      to: null
    nexttasks:
      "No":
      - "148"
      "Yes":
      - "170"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: dff486ba-3e4f-42f0-8c29-d767f19b36e2
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: Quarantine File?
      playbooktaskmissingcomponent: null
      type: condition
      version: -1
    taskid: dff486ba-3e4f-42f0-8c29-d767f19b36e2
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 162.5,
          "y": 1485
        }
      }
  "165":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: issue.mitreattcktechnique
          operator: match
          right:
            value:
              simple: (T1059|T1486|T1071|T1095|T1068|T1021|T1027|T1003|T1547|T1074|T1485|T1046|T1498)
      label: "yes"
    continueonerrortype: ""
    id: "165"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "148"
      "yes":
      - "158"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Techniques Covered
        T1059 – Command & Scripting Interpreter
        T1486 – Data Encrypted for Impact
        T1071 – Application Layer Protocol
        T1095 – Non-Application Layer Protocol
        T1068 – Exploitation for Privilege Escalation
        T1021 – Remote Services
        T1027 – Obfuscated Files or Information
        T1003 – OS Credential Dumping
        T1547 – Boot or Logon Autostart Execution
        T1074 – Data Staged
        T1485 – Data Destruction
        T1046 – Network Service Discovery
        T1498 – Network Denial of Service
      id: ee42b9d3-f370-49c5-8a4e-ca754a7c2211
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: Miter Technique for Isolation
      playbooktaskmissingcomponent: null
      type: condition
      version: -1
    taskid: ee42b9d3-f370-49c5-8a4e-ca754a7c2211
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 622.5,
          "y": 1300
        }
      }
  "168":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              simple: inputs.FileVerdict
          operator: isEqualString
          right:
            value:
              simple: Suspicious
      label: "yes"
    continueonerrortype: ""
    id: "168"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "148"
      "yes":
      - "161"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: fe29a7f1-1dd7-4fb3-81af-00704151f661
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: Quarantine file needed?
      playbooktaskmissingcomponent: null
      type: condition
      version: -1
    taskid: fe29a7f1-1dd7-4fb3-81af-00704151f661
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1300
        }
      }
  "169":
    continueonerrortype: ""
    id: "169"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "148"
    note: false
    quietmode: 0
    scriptarguments:
      Endpoint ID:
        simple: ${inputs.EndpointID}
      Endpoint IP:
        simple: ${inputs.IP}
      Endpoint hostname:
        simple: ${inputs.Hostname}
      ShadowMode:
        simple: ${inputs.ShadowMode}
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: Determine the correct playbook to run for the correct endpoint
        product.
      id: 0034e537-0923-4d4c-a763-a21ac1993209
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: SOC Isolation Router_V3
      playbookId: SOC Isolation Router_V3
      playbooktaskmissingcomponent: null
      type: playbook
      version: -1
    taskid: 0034e537-0923-4d4c-a763-a21ac1993209
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 857.5,
          "y": 1670
        }
      }
  "170":
    continueonerrortype: ""
    id: "170"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "148"
    note: false
    quietmode: 0
    scriptarguments:
      AutoContainment:
        simple: ${inputs.AutoContainment}
      EndpointID:
        simple: ${inputs.EndpointID}
      FileContainment:
        simple: "True"
      FileHash:
        simple: ${inputs.FileHash}
      FilePath:
        simple: ${inputs.FilePath}
      FileRemediation:
        simple: Quarantine
      ShadowMode:
        simple: "true"
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: |-
        ## Containment Plan - Quarantine File

        This playbook is a sub-playbook within the containment plan playbook.
        The playbook quarantines files using core commands.
      id: 48b8dce7-7461-4030-b641-de2dce672c35
      iscommand: false
      istaskmissingcomponenterrordismissed: false
      name: SOC Containment Plan_V3 - Quarantine File_V3
      playbookId: SOC Containment Plan_V3 - Quarantine File_V3
      playbooktaskmissingcomponent: null
      type: playbook
      version: -1
    taskid: 48b8dce7-7461-4030-b641-de2dce672c35
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 285,
          "y": 1670
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "138_139_#default#": 0.64,
      "150_138_#default#": 0.9,
      "161_170_Yes": 0.85
    },
    "paper": {
      "dimensions": {
        "height": 1865,
        "width": 1187.5,
        "x": 50,
        "y": 50
      }
    }
  }
